<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/ico" href="https://wp-assets.highcharts.com/www-highcharts-com/blog/wp-content/uploads/2021/05/19085042/favicon-1.ico"/>
    <title>Power Outage Analysis Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #006986;
            --secondary: #007566;

            --primary_txt: #00c8ff;
            --secondary_txt: #00ffdd;

            --success: #00d2ff;
            --danger: #ff416c;
            --dark: #0f172a;
            --darker: #0a0f1c;
            --light: #e2e8f0;
            --card-bg: rgba(15, 23, 42, 0.7);
            --glass: rgba(255, 255, 255, 0.05);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px 15px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--primary_txt), var(--secondary_txt));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 198, 255, 0.3);
        }

        .subtitle {
            font-size: 1rem;
            color: #94a3b8;
            max-width: 600px;
            margin: 0 auto;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
        }

        .card:hover {
            /* transform: translateY(-1px); */
            box-shadow: 0 12px 30px rgba(0, 255, 242, 0.041);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-header i {
            font-size: 1.3rem;
            margin-right: 10px;
            color: var(--primary);
        }

        .card-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .styled-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
        }

        .styled-table thead tr {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            text-align: left;
            font-weight: 600;
        }

        .styled-table th, .styled-table td {
            padding: 10px 12px;
        }

        .styled-table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
        }

        .styled-table tbody tr.power-row {
            background-color: rgba(0, 87, 107, 0.144);
        }

        .styled-table tbody tr.blackout-row {
            background-color: rgba(2, 27, 56, 0.308);
        }


        .styled-table tbody tr.high-voltage-row {
            background-color: rgba(2, 27, 56, 0.308);
        }

        .styled-table tbody tr.low-voltage-row {
            
            background-color: rgba(2, 27, 56, 0.308);
        }

        .styled-table tbody tr:hover {
            background: rgb(78, 16, 45);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-power {
            background: rgb(80, 214, 255);
            color: #000000;
        }

        .status-blackout {
            background: rgb(255, 143, 169);
            color: #000000;
        }

        .status-high {
            background: rgb(255, 143, 169);
            color: #000000;
        }

        .status-low {

            background: rgb(80, 214, 255);
            color: #000000;

        }

        .status-normal {
            background: rgba(0, 255, 255, 0.2);
            color: var(--success);
        }

        .ongoing-blackout {
            color: #ff416c !important;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .ongoing-power {
            color: #00d2ff !important;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .chart-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            margin-top: 20px;
            height: 400px;
            margin-bottom: 20px; /* Added spacing between chart and voltage extremes */
        }

        .chart-container:hover {
            /* transform: translateY(-1px); */
            box-shadow: 0 12px 30px rgba(0, 255, 242, 0.041);
        }

        .chart-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-header i {
            font-size: 1.3rem;
            margin-right: 10px;
            color: var(--primary);
        }

        .chart-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: #94a3b8;
            font-size: 0.85rem;
        }

        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 198, 255, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .last-update {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-message {
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
            text-align: center;
            transition: var(--transition);
        }

        .status-message i {
            margin-right: 8px;
        }

        .status-normal {
            background: rgba(0, 210, 255, 0.1);
            border: 1px solid rgba(0, 210, 255, 0.2);
        }

        .status-normal i {
            color: var(--success);
        }

        .status-warning {
            background: rgba(255, 65, 108, 0.1);
            border: 1px solid rgba(255, 65, 108, 0.2);
        }

        .status-warning i {
            color: var(--danger);
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Mobile-first responsive design */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            header {
                padding: 15px 10px;
                margin-bottom: 15px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .card, .chart-container {
                padding: 15px;
            }
            
            .card-header h2, .chart-header h2 {
                font-size: 1.2rem;
            }
            
            .styled-table {
                font-size: 0.75rem;
            }
            
            .styled-table th, .styled-table td {
                padding: 8px 6px;
            }
            
            .chart-container {
                height: 350px;
                padding: 15px;
                padding-bottom: 17%;
                margin-bottom: 15px; /* Adjusted for mobile */
            }
        }

        @media (min-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .card, .chart-container {
                padding: 25px;
            }
            
            .chart-container {
                height: 450px;
                padding-bottom: 7%;
                margin-bottom: 20px; /* Adjusted for tablet */
            }
        }

        @media (min-width: 992px) {
            .chart-container {
                height: 500px;
                margin-bottom: 20px; /* Adjusted for desktop */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-bolt"></i> Power Outage Analysis Dashboard</h1>
            <p class="subtitle">Real-time monitoring and analysis of power availability and blackout periods</p>
        </header>

        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-table"></i>
                    <h2>Power / Blackout Periods</h2>
                </div>
                
                <div id="results">
                    <div class="loader">
                        <div class="spinner"></div>
                    </div>
                </div>
                
                <div class="last-update">
                    <i class="fas fa-clock"></i> Last Update: <span id="lastUpdateTime">-</span>
                </div>
                
                <div class="status-message" id="statusMessage" style="display: none;">
                    <i class="fas fa-check-circle"></i> <span id="statusText">No blackout detected</span>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-header">
                <i class="fas fa-chart-line"></i>
                <h2>Outage Duration Analysis</h2>
            </div>
            <canvas id="outageChart"></canvas>
        </div>

        <!-- New Voltage Extremes Card -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-bar"></i>
                <h2>Voltage Extremes</h2>
            </div>
            <div id="voltageExtremes">
                <div class="loader">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Power Outage Analysis Dashboard &copy; 2025 | Serhii B.</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables to store data and chart instance
        let allFeeds = [];
        let outageChart = null;
        let updateInterval;
        const fiveMinutes = 5 * 60 * 1000; // 5 minutes in milliseconds
        const UPDATE_INTERVAL = 60000; // 60 seconds

        document.addEventListener("DOMContentLoaded", function() {
            // Initial load with full dataset
            loadInitialData();
            
            // Set up periodic updates
            setupLiveUpdates();
        });

        function loadInitialData() {
            const timestamp = new Date().getTime();
            const url = `https://api.thingspeak.com/channels/1288695/fields/1.json?offset=0&results=5400&key=KMPJJFINTMO4GWQK&_=${timestamp}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    allFeeds = data.feeds;
                    processData();
                })
                .catch(error => {
                    console.error('Error fetching initial data:', error);
                    document.getElementById('results').innerHTML = '<p>Error loading data. Please try again later.</p>';
                });
        }

        function updateLiveData() {
            const timestamp = new Date().getTime();
            const url = `https://api.thingspeak.com/channels/1288695/fields/1.json?offset=0&results=5&key=KMPJJFINTMO4GWQK&_=${timestamp}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.feeds && data.feeds.length > 0) {
                        // Merge new data with existing data, avoiding duplicates
                        mergeNewData(data.feeds);
                        processData();
                    }
                })
                .catch(error => {
                    console.error('Error updating data:', error);
                });
        }

        function mergeNewData(newFeeds) {
            if (newFeeds.length === 0) return;
            
            // Find the latest entry_id in our current data
            const latestEntryId = allFeeds.length > 0 
                ? Math.max(...allFeeds.map(feed => parseInt(feed.entry_id)))
                : 0;
            
            // Filter out any entries we already have
            const uniqueNewFeeds = newFeeds.filter(feed => 
                parseInt(feed.entry_id) > latestEntryId
            );
            
            // Add new entries to our data
            allFeeds = [...allFeeds, ...uniqueNewFeeds];
            
            // Sort by entry_id to maintain chronological order
            allFeeds.sort((a, b) => parseInt(a.entry_id) - parseInt(b.entry_id));
        }

        function processData() {
            const gaps = findDataGaps(allFeeds);
            displayGaps(gaps, allFeeds);
            createOutageChart(gaps);
            updateLastUpdateTime(allFeeds);
            updateStatusMessage(allFeeds);
            findVoltageExtremes(allFeeds);
        }

        function setupLiveUpdates() {
            // Start the update interval
            updateInterval = setInterval(updateLiveData, UPDATE_INTERVAL);
        }



        function findDataGaps(feeds) {
            const gaps = [];

            for (let i = 1; i < feeds.length; i++) {
                const previousTime = new Date(feeds[i - 1].created_at).getTime();
                const currentTime = new Date(feeds[i].created_at).getTime();
                const difference = currentTime - previousTime;

                if (difference >= fiveMinutes) {
                    const gapDurationMinutes = difference / (60 * 1000);
                    gaps.push({
                        start: feeds[i - 1].created_at,
                        end: feeds[i].created_at,
                        duration: gapDurationMinutes,
                        hasPower: false
                    });
                } else {
                    if (i == 1 || gaps[gaps.length - 1].hasPower === false) {
                        gaps.push({
                            start: feeds[i - 1].created_at,
                            end: feeds[i].created_at,
                            duration: difference / (60 * 1000),
                            hasPower: true
                        });
                    } else {
                        gaps[gaps.length - 1].end = feeds[i].created_at;
                        gaps[gaps.length - 1].duration += difference / (60 * 1000);
                    }
                }
            }

            // Check the last data point
            const lastTime = new Date(feeds[feeds.length - 1].created_at).getTime();
            const now = new Date().getTime();
            const currentDifference = now - lastTime;

            if (currentDifference >= fiveMinutes) {
                const ongoingDurationMinutes = currentDifference / (60 * 1000);
                gaps.push({
                    start: feeds[feeds.length - 1].created_at,
                    end: 'ongoing',
                    duration: ongoingDurationMinutes,
                    hasPower: false
                });
            } else {
                if (gaps.length > 0 && gaps[gaps.length - 1].hasPower) {
                    gaps[gaps.length - 1].end = 'ongoing';
                    gaps[gaps.length - 1].duration += currentDifference / (60 * 1000);
                } else {
                    gaps.push({
                        start: feeds[feeds.length - 1].created_at,
                        end: 'ongoing',
                        duration: currentDifference / (60 * 1000),
                        hasPower: true
                    });
                }
            }

            return gaps;
        }

        function displayGaps(gaps, feeds) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (gaps.length === 0) {
                resultsDiv.innerHTML = '<p>No power outages of 5 minutes or more detected.</p>';
            } else {
                const table = document.createElement('table');
                table.classList.add('styled-table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Duration</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                `;

                const tbody = table.querySelector('tbody');

                // Show only the most recent 50 periods in the table for better performance
                const recentGaps = gaps.slice(-50);
                
                recentGaps.forEach(gap => {
                    const localStart = formatDateTime(gap.start);
                    let localEnd;
                    
                    if (gap.end === 'ongoing') {
                        if (gap.hasPower) {
                            localEnd = `<span class="ongoing-power">Power Available</span>`;
                        } else {
                            localEnd = `<span class="ongoing-blackout">Ongoing Blackout</span>`;
                        }
                    } else {
                        localEnd = formatDateTime(gap.end);
                    }
                    
                    const hours = Math.floor(gap.duration / 60);
                    const minutes = Math.floor(gap.duration % 60);
                    const row = document.createElement('tr');
                    row.classList.add(gap.hasPower ? 'power-row' : 'blackout-row');
                    row.innerHTML = `
                        <td>${localStart}</td>
                        <td>${localEnd}</td>
                        <td>${hours}h ${minutes}m</td>
                        <td><span class="status-badge ${gap.hasPower ? 'status-power' : 'status-blackout'}">${gap.hasPower ? 'Power' : 'Blackout'}</span></td>
                    `;
                    tbody.appendChild(row);
                });

                resultsDiv.appendChild(table);
                
                // Add a note if there are more periods
                if (gaps.length > 50) {
                    const note = document.createElement('p');
                    note.style.marginTop = '15px';
                    note.style.textAlign = 'center';
                    note.style.color = '#94a3b8';
                    note.innerHTML = `Showing 50 most recent periods out of ${gaps.length} total`;
                    resultsDiv.appendChild(note);
                }
            }
        }

        // NEW FUNCTION: Find and display voltage extremes
        function findVoltageExtremes(feeds) {
            if (!feeds || feeds.length === 0) {
                document.getElementById('voltageExtremes').innerHTML = '<p>No voltage data available.</p>';
                return;
            }

            let minVoltage = { value: Infinity, time: null, entry_id: null };
            let maxVoltage = { value: -Infinity, time: null, entry_id: null };
            let lastVoltage = { value: null, time: null, entry_id: null };

            // Filter out entries with null or undefined field1 values
            const validFeeds = feeds.filter(feed => feed.field1 !== null && feed.field1 !== undefined);

            if (validFeeds.length === 0) {
                document.getElementById('voltageExtremes').innerHTML = '<p>No valid voltage readings found.</p>';
                return;
            }

            // Find min and max voltage
            validFeeds.forEach(feed => {
                const voltage = parseFloat(feed.field1);
                
                if (!isNaN(voltage)) {
                    if (voltage < minVoltage.value) {
                        minVoltage.value = voltage;
                        minVoltage.time = feed.created_at;
                        minVoltage.entry_id = feed.entry_id;
                    }
                    
                    if (voltage > maxVoltage.value) {
                        maxVoltage.value = voltage;
                        maxVoltage.time = feed.created_at;
                        maxVoltage.entry_id = feed.entry_id;
                    }
                }
            });

            // Get the last voltage reading
            const lastFeed = validFeeds[validFeeds.length - 1];
            lastVoltage.value = parseFloat(lastFeed.field1);
            lastVoltage.time = lastFeed.created_at;
            lastVoltage.entry_id = lastFeed.entry_id;

            // Display the results
            displayVoltageExtremes(minVoltage, maxVoltage, lastVoltage);
        }

        // NEW FUNCTION: Display voltage extremes in a table
        function displayVoltageExtremes(minVoltage, maxVoltage, lastVoltage) {
            const voltageDiv = document.getElementById('voltageExtremes');
            
            if (minVoltage.value === Infinity || maxVoltage.value === -Infinity) {
                voltageDiv.innerHTML = '<p>No valid voltage readings found.</p>';
                return;
            }

            const table = document.createElement('table');
            table.classList.add('styled-table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Voltage (V)</th>
                        <th>Detected At</th>
                        <th>Entry ID</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="high-voltage-row">
                        <td><span class="status-badge status-high">Highest</span></td>
                        <td>${maxVoltage.value.toFixed(1)}</td>
                        <td>${formatDateTime(maxVoltage.time)}</td>
                        <td>${maxVoltage.entry_id}</td>
                    </tr>
                    <tr class="low-voltage-row">
                        <td><span class="status-badge status-low">Lowest</span></td>
                        <td>${minVoltage.value.toFixed(1)}</td>
                        <td>${formatDateTime(minVoltage.time)}</td>
                        <td>${minVoltage.entry_id}</td>
                    </tr>
                    <tr class="power-row">
                        <td><span class="status-badge status-normal">Last</span></td>
                        <td>${lastVoltage.value.toFixed(1)}</td>
                        <td>${formatDateTime(lastVoltage.time)}</td>
                        <td>${lastVoltage.entry_id}</td>
                    </tr>
                </tbody>
            `;

            voltageDiv.innerHTML = '';
            voltageDiv.appendChild(table);
        }

        function formatDateTime(dateTime) {
            const date = new Date(dateTime);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        }

        function createOutageChart(gaps) {
            // Limit the number of data points to prevent performance issues
            const maxDataPoints = 50;
            const displayGaps = gaps.length > maxDataPoints ? gaps.slice(-maxDataPoints) : gaps;
            
            // Create simpler labels for the chart
            const labels = displayGaps.map((gap, index) => {
                const date = new Date(gap.start);
                return `${date.getDate()}/${date.getMonth()+1} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
            });
            
            const datasets = [
                {
                    label: 'Blackout Duration',
                    data: displayGaps.map(gap => !gap.hasPower ? gap.duration : 0),
                    backgroundColor: '#ff416c',
                    borderRadius: 5,
                },
                {
                    label: 'Power Duration',
                    data: displayGaps.map(gap => gap.hasPower ? gap.duration : 0),
                    backgroundColor: '#00d2ff',
                    borderRadius: 5,
                }
            ];

            const ctx = document.getElementById('outageChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (outageChart) {
                outageChart.destroy();
            }
            
            outageChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0 // disables animation only on initial draw
                    },
                    hover: {
                        animationDuration: 400 // keeps smooth hover transitions
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    size: window.innerWidth < 768 ? 10 : 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const gap = displayGaps[tooltipItems[0].dataIndex];
                                    const start = formatDateTime(gap.start);
                                    let end;
                                    if (gap.end === 'ongoing') {
                                        if (gap.hasPower) {
                                            end = 'Power Available';
                                        } else {
                                            end = 'Ongoing Blackout';
                                        }
                                    } else {
                                        end = formatDateTime(gap.end);
                                    }
                                    return `${start} to ${end}`;
                                },
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw;
                                    const hours = Math.floor(value / 60);
                                    const minutes = Math.floor(value % 60);
                                    return `${label}: ${hours}h ${minutes}m`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: window.innerWidth < 768 ? 45 : 0,
                                minRotation: window.innerWidth < 768 ? 45 : 0,
                                font: {
                                    size: window.innerWidth < 768 ? 9 : 11
                                }
                            }
                        },
                        y: {
                            stacked: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    const hours = Math.floor(value / 60);
                                    const minutes = Math.floor(value % 60);
                                    return `${hours}h ${minutes}m`;
                                },
                                font: {
                                    size: window.innerWidth < 768 ? 9 : 11
                                }
                            },
                            title: {
                                display: true,
                                text: 'Duration',
                                color: '#94a3b8',
                                font: {
                                    size: window.innerWidth < 768 ? 10 : 12
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateLastUpdateTime(feeds) {
            if (feeds.length > 0) {
                const lastUpdate = new Date(feeds[feeds.length - 1].created_at);
                const lastUpdateFormatted = formatDateTime(lastUpdate);
                document.getElementById('lastUpdateTime').textContent = lastUpdateFormatted;
            }
        }

        function updateStatusMessage(feeds) {
            if (feeds.length > 0) {
                const lastTime = new Date(feeds[feeds.length - 1].created_at).getTime();
                const now = new Date().getTime();
                const currentDifference = now - lastTime;
                
                const statusMessage = document.getElementById('statusMessage');
                const statusText = document.getElementById('statusText');
                const icon = statusMessage.querySelector('i');
                
                if (currentDifference < fiveMinutes) {
                    // No blackout - use check circle
                    icon.className = "fas fa-check-circle";
                    statusText.textContent = "No blackout detected";
                    statusMessage.style.display = 'block';
                    statusMessage.className = "status-message status-normal";
                } else {
                    // Blackout detected - use exclamation triangle with blinking animation
                    icon.className = "fas fa-exclamation-triangle";
                    statusText.textContent = "Blackout detected";
                    statusMessage.style.display = 'block';
                    statusMessage.className = "status-message status-warning";
                }
            }
        }
    </script>
</body>
</html>